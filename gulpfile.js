/**
 * Created by leefsmp on 4/16/15.
 */
var gulp = require("gulp");
var gutil = require("gulp-util");
var clean = require('gulp-clean');
var ngmin = require('gulp-ngmin');
var rename = require('gulp-rename');
var uglify = require('gulp-uglify');
var webpack = require("gulp-webpack");
var webpackConfig = require("./webpack.config.js");

///////////////////////////////////////////////////////////////////////////
// Clean Task
//
///////////////////////////////////////////////////////////////////////////
gulp.task('clean', function () {

  return gulp.src('www/build/*.js', {read: false})
    .pipe(clean());
});

///////////////////////////////////////////////////////////////////////////
// Webpack build task
//
///////////////////////////////////////////////////////////////////////////
gulp.task("webpack:build", ['clean'], function(callback) {

  return gulp.src('www/js/app.js')
    .pipe(webpack(webpackConfig))
    .pipe(gulp.dest('www/build'));
});

///////////////////////////////////////////////////////////////////////////
// Compress task: uglyfy and minify js
//
///////////////////////////////////////////////////////////////////////////
gulp.task('compress', ['webpack:build'], function() {

  return gulp.src('www/build/*.js')
    .pipe(ngmin())
    .pipe(uglify({mangle: false}))
    .pipe(rename({extname: ".min.js"}))
    .pipe(gulp.dest('www/build'));
});

///////////////////////////////////////////////////////////////////////////
// Debug build
//
///////////////////////////////////////////////////////////////////////////
gulp.task('build-debug', ['webpack:build']);

///////////////////////////////////////////////////////////////////////////
// Production build
//
///////////////////////////////////////////////////////////////////////////
gulp.task('build-prod', ['compress']);

///////////////////////////////////////////////////////////////////////////
// Default task
//
///////////////////////////////////////////////////////////////////////////
gulp.task('default', ['build-prod']);
